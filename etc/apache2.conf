<Macro mdref_host_defs>
	ServerName mdref.m6w6.name
	ServerAdmin webmaster@m6w6.name

	DocumentRoot /var/www/mdref/mdref/public

	<Directory /var/www/mdref/mdref/public>
		AllowOverride None
		Require all granted
		DirectorySlash Off
		RewriteEngine On
		RewriteCond %{REQUEST_FILENAME} -f [OR]
		RewriteCond %{REQUEST_FILENAME} -d [OR]
		RewriteCond %{REQUEST_FILENAME} -l
		RewriteRule ^ - [L]
		RewriteRule ^ index.php [L]
		<FilesMatch ".+\.ph(p|tml)$">
			SetHandler "proxy:unix:/run/php/php-mdref.sock|fcgi://localhost"
		</FilesMatch>
	</Directory>
</Macro>

<VirtualHost *:80>
	Use mdref_host_defs
	<IfModule ssl_module>
		Redirect permanent / https://mdref.m6w6.name/
	</IfModule>
</VirtualHost>

<IfModule ssl_module>
	<VirtualHost *:443>
		Use mdref_host_defs
		Include "bits/hsts"
		SSLEngine on
		SSLUseStapling on
		SSLCertificateKeyFile /etc/letsencrypt/live/m6w6.name/privkey.pem
		SSLCertificateFile /etc/letsencrypt/live/m6w6.name/fullchain.pem
	</VirtualHost>
</IfModule>
# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
